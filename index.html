<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finnhub Stock Tracker (Global Functions)</title>

  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script defer>
    const FINNHUB_KEY = "d5eaap9r01qjckl2rtg0d5eaap9r01qjckl2rtgg";
    let currentSymbol = "";
    let chart;

    const getLS = k => JSON.parse(localStorage.getItem(k) || '[]');
    const setLS = (k,v) => localStorage.setItem(k, JSON.stringify(v));

    // ---------- WATCHLIST ----------
    function addToWatchlist(){
      const list = getLS('watchlist');
      if(!list.includes(currentSymbol)) list.push(currentSymbol);
      setLS('watchlist', list); renderWatchlist();
    }

    function renderWatchlist(){
      const ul = document.getElementById('watchlist'); ul.innerHTML='';
      const list = getLS('watchlist');
      list.forEach(s=>{
        const li = document.createElement('li');
        li.className = 'flex justify-between bg-gray-100 p-2 rounded';

        const span = document.createElement('span');
        span.className = 'cursor-pointer';
        span.textContent = s;
        span.onclick = function(){ loadStock(s); };

        const btn = document.createElement('button');
        btn.textContent = 'âœ•';
        btn.onclick = function(){ removeFrom('watchlist', s); };

        li.appendChild(span);
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    function removeFrom(k,s){ setLS(k,getLS(k).filter(x=>x!==s)); renderWatchlist(); }

    // ---------- PORTFOLIO ----------
    function addToPortfolio(){
      const qty = prompt('Shares:');
      const price = prompt('Buy price:');
      if(!qty || !price) return;
      const p = getLS('portfolio');
      p.push({symbol:currentSymbol, qty:+qty, price:+price});
      setLS('portfolio', p); renderPortfolio();
    }

    function renderPortfolio(){
      const ul = document.getElementById('portfolio'); ul.innerHTML='';
      const data = getLS('portfolio');
      if(data.length === 0){ ul.innerHTML = '<li class="text-gray-500">No positions</li>'; return; }
      data.forEach((pos,i)=>{
        const li = document.createElement('li');
        li.className = 'bg-gray-100 p-2 rounded flex justify-between items-center';

        const span = document.createElement('span');
        span.textContent = `${p
